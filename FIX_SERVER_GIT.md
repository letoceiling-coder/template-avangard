# Исправление проблемы Git на сервере

## Проблема

```
error: Your local changes to the following files would be overwritten by merge:
        .htaccess
        deploy.php
Please commit your changes or stash them before you merge.
```

На сервере есть локальные изменения в `.htaccess` и `deploy.php`, которые блокируют git pull.

---

## Решение

### Вариант 1: Сохранить локальные изменения (РЕКОМЕНДУЕТСЯ)

Подключитесь к серверу через SSH и выполните:

```bash
# 1. Перейти в директорию проекта
cd /путь/к/проекту

# 2. Сохранить локальные изменения
git stash

# 3. Обновить из GitHub
git pull origin main

# 4. Восстановить локальные изменения
git stash pop

# 5. Если есть конфликты - разрешить их вручную
```

### Вариант 2: Сбросить локальные изменения (ОСТОРОЖНО!)

Если локальные изменения не важны:

```bash
# 1. Перейти в директорию проекта
cd /путь/к/проекту

# 2. Сбросить изменения в .htaccess и deploy.php
git checkout -- .htaccess
git checkout -- deploy.php

# 3. Обновить из GitHub
git pull origin main
```

### Вариант 3: Автоматическое исправление в deploy.php

Обновить `deploy.php` на сервере, добавив команды для автоматического разрешения конфликтов:

```php
// В функции gitPull() добавить перед git pull:

// Сохранить локальные изменения перед pull
exec('git stash 2>&1', $output, $return_code);

// Выполнить pull
exec('git pull origin main 2>&1', $output, $return_code);

// Восстановить локальные изменения
exec('git stash pop 2>&1', $output, $return_code);
```

---

## Проверка обновления

После исправления проблемы:

1. **Откройте сайт:** https://bot.siteaccess.ru/
2. **Откройте DevTools (F12)**
3. **Перейдите на вкладку Console**
4. **Обновите страницу (F5)**

Вы должны увидеть:

```
✅ LiveGrid Deploy 2026-01-31 18:31
Обновления:
  ✓ Header: новая структура с иконкой избранного
  ✓ Геолокация: кликабельная с модальным окном
  ✓ Поиск: активный с Enter
  ✓ Бургер-меню: работает с анимацией
  ✓ Страница избранного: /favorites
Проверьте: откройте DevTools и посмотрите этот лог!
```

---

## Дополнительная проверка

1. **Проверить Header:**
   - Логотип → "Все объекты" → Меню → ♥ (сердце) → "Войти"
   - Иконка сердца должна быть видна

2. **Проверить геолокацию:**
   - Кликнуть на "Москва и МО"
   - Должно открыться модальное окно

3. **Проверить поиск:**
   - Ввести текст в поиск
   - Нажать Enter
   - Должен перейти в /catalog?q=...

4. **Проверить бургер-меню (mobile):**
   - Уменьшить окно браузера
   - Кликнуть на бургер
   - Должно открыться меню

5. **Проверить избранное:**
   - Кликнуть на иконку ♥
   - Должна открыться страница /favorites

---

## Команды для SSH

```bash
# Подключиться к серверу
ssh user@bot.siteaccess.ru

# Перейти в проект
cd /путь/к/figma-trendagent

# Посмотреть статус
git status

# Посмотреть локальные изменения
git diff .htaccess
git diff deploy.php

# Сохранить изменения
git stash

# Обновить
git pull origin main

# Восстановить
git stash pop

# Проверить последний коммит
git log -1

# Должно быть:
# commit 788acfb...
# Deploy: 2026-01-31 18:31:28
```

---

## Если проблема повторяется

Добавить в `.gitignore` файлы, которые часто меняются на сервере:

```bash
# На локальной машине
echo ".htaccess" >> .gitignore
echo "deploy.php" >> .gitignore

git add .gitignore
git commit -m "Ignore server-specific files"
git push origin main
```

Но **ОСТОРОЖНО**: это означает, что изменения в этих файлах не будут попадать на сервер автоматически.

---

## Альтернатива: Использовать force pull

В `deploy.php` можно добавить force pull (перезаписывает локальные изменения):

```php
function gitPull() {
    $commands = [
        'git fetch origin main 2>&1',
        'git reset --hard origin/main 2>&1',
    ];
    
    // ... rest of code
}
```

**ВНИМАНИЕ:** Это удалит все локальные изменения!
